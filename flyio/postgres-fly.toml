app = 'almacen-postgres'
primary_region = 'iad'

[build]
dockerfile = "postgres.dockerfile"

[env]
POSTGRES_DB = "almacen"
POSTGRES_USER = "almacen_user"
PGDATA = "/var/lib/postgresql/data/pgdata"
# POSTGRES_PASSWORD should be set as a secret, not here

[mounts]
source = "postgres_data"
destination = "/var/lib/postgresql/data"
initial_size = "10gb"

[[services]]
internal_port = 5432
protocol = "tcp"
auto_stop_machines = false
auto_start_machines = true
min_machines_running = 1

[[services.ports]]
port = 5432

[services.concurrency]
type = "connections"
hard_limit = 1000
soft_limit = 1000

[[vm]]
memory = '1gb'
cpu_kind = 'shared'
cpus = 1

[metrics]
port = 9187
path = "/metrics"
